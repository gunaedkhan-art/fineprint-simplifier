<header class="header">
    <!-- First Row: Site Title (Left) and Navigation (Right) -->
    <div class="header-top">
        <div class="logo-section">
            <a href="/" class="logo-link">
                <h1 class="logo">ðŸ“‹ Small Print Checker</h1>
            </a>
        </div>
        
        <!-- Desktop Navigation -->
        <nav class="nav">
            <a href="/" class="nav-link {% if request.url.path == '/' %}active{% endif %}">Home</a>
            <a href="/upload" class="nav-link {% if request.url.path == '/upload' %}active{% endif %}">Analyze</a>
            <a href="/compare" class="nav-link {% if request.url.path == '/compare' %}active{% endif %}">Compare</a>
            <a href="/how-it-works" class="nav-link {% if request.url.path == '/how-it-works' %}active{% endif %}">How It Works</a>
            <a href="/pricing" class="nav-link {% if request.url.path == '/pricing' %}active{% endif %}">Pricing</a>
            
            {% if user_authenticated and user %}
                <!-- Authenticated User Navigation -->
                <div class="profile-dropdown" id="profileDropdown">
                    <div class="profile-section">
                        <a href="/profile" class="profile-avatar" id="profileAvatar">{{ user.username[0].upper() if user.username else 'ðŸ‘¤' }}</a>
                        <a href="/profile" class="profile-text">Profile</a>
                    </div>
                    <div class="profile-dropdown-content">
                        <div class="user-status-info" id="userStatusInfo">
                            <div class="status-line">
                                <span class="status-label">Plan:</span>
                                <span class="status-value" id="userPlan">{{ user.subscription.title() if user.subscription else 'Free' }}</span>
                            </div>
                            <div class="status-line">
                                <span class="status-label">Usage:</span>
                                <span class="status-value" id="userUsage">{{ user.usage.documents_this_month if user.usage else 0 }}/{{ user.usage.monthly_limit if user.usage else 3 }}</span>
                            </div>
                        </div>
                        <a href="/profile" class="profile-link">My Profile</a>
                        {% if user.subscription == 'paid' %}
                        <a href="/subscription-management" class="profile-link" id="subscriptionLink">Manage Subscription</a>
                        {% endif %}
                        <a href="#" onclick="logout()" class="logout-link">Logout</a>
                    </div>
                </div>
            {% elif request.url.path != '/login' and request.url.path != '/register' %}
                <!-- Guest User Navigation (not on login/register pages) -->
                <div class="auth-cta" id="authCTA">
                    <a href="/login" class="btn-primary">Sign In</a>
                </div>
            {% endif %}
        </nav>
        
        <!-- Mobile Header Actions -->
        <div class="mobile-header-actions">
            {% if user_authenticated and user %}
                <!-- Mobile Profile Icon for Authenticated Users -->
                <div class="mobile-profile-dropdown">
                    <a href="/profile" class="mobile-profile-avatar" id="mobileProfileAvatar">{{ user.username[0].upper() if user.username else 'ðŸ‘¤' }}</a>
                    <div class="mobile-profile-dropdown-content">
                        <div class="user-status-info">
                            <div class="status-line">
                                <span class="status-label">Plan:</span>
                                <span class="status-value">{{ user.subscription.title() if user.subscription else 'Free' }}</span>
                            </div>
                            <div class="status-line">
                                <span class="status-label">Usage:</span>
                                <span class="status-value">{{ user.usage.documents_this_month if user.usage else 0 }}/{{ user.usage.monthly_limit if user.usage else 3 }}</span>
                            </div>
                        </div>
                        <a href="/profile" class="profile-link">My Profile</a>
                        {% if user.subscription == 'paid' %}
                        <a href="/subscription-management" class="profile-link">Manage Subscription</a>
                        {% endif %}
                        <a href="#" onclick="logout()" class="logout-link">Logout</a>
                    </div>
                </div>
            {% elif request.url.path != '/login' and request.url.path != '/register' %}
                <!-- Mobile Sign In Link for Guest Users (not on login/register pages) -->
                <a href="/login" class="mobile-signin-link">Sign In</a>
            {% endif %}
            
            <button class="mobile-menu-toggle" aria-label="Toggle mobile menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </div>
    
    <!-- Second Row: Tagline (Left Aligned) -->
    <div class="header-bottom">
        <p class="tagline">Understand your contracts in plain English</p>
    </div>
    <nav class="mobile-nav">
        <a href="/" class="nav-link {% if request.url.path == '/' %}active{% endif %}">Home</a>
        <a href="/upload" class="nav-link {% if request.url.path == '/upload' %}active{% endif %}">Analyze</a>
        <a href="/compare" class="nav-link {% if request.url.path == '/compare' %}active{% endif %}">Compare</a>
        <a href="/how-it-works" class="nav-link {% if request.url.path == '/how-it-works' %}active{% endif %}">How It Works</a>
        <a href="/pricing" class="nav-link {% if request.url.path == '/pricing' %}active{% endif %}">Pricing</a>
        
        {% if user_authenticated and user %}
            <!-- Authenticated Mobile Navigation -->
            <div id="mobileProfileSection">
                <a href="/profile" class="nav-link">My Profile</a>
                {% if user.subscription == 'paid' %}
                <a href="/subscription-management" class="nav-link" id="mobileSubscriptionLink">Manage Subscription</a>
                {% endif %}
                <a href="#" onclick="logout()" class="nav-link">Logout</a>
            </div>
        {% endif %}
    </nav>
</header>

<script>
function logout() {
    localStorage.removeItem('access_token');
    localStorage.removeItem('fineprint_user_id');
    document.cookie = 'access_token=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT';
    window.location.href = '/';
}
</script>
