<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pricing - Small Print Checker</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo-section">
                    <a href="/" class="logo-link">
                        <h1 class="logo">ðŸ“‹ Small Print Checker</h1>
                        <p class="tagline">Understand your contracts in plain English</p>
                    </a>
                </div>
                <nav class="nav">
                    <a href="/" class="nav-link">Home</a>
                    <a href="/upload" class="nav-link">Analyze</a>
                    <a href="/compare" class="nav-link">Compare</a>
                    <a href="/how-it-works" class="nav-link">How It Works</a>
                    <a href="/pricing" class="nav-link active">Pricing</a>
                </nav>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <div class="page-header">
                <h1 class="page-title">Choose Your Plan</h1>
                <p class="page-subtitle">Start free and upgrade when you need more features</p>
            </div>

    <div class="pricing-container">
        <!-- Free Tier -->
        <div class="pricing-card free-tier">
            <div class="pricing-header">
                <h2>Free</h2>
                <div class="price">
                    <span class="amount">$0</span>
                    <span class="period">/month</span>
                </div>
                <p class="description">Perfect for occasional document review</p>
            </div>
            
            <div class="features">
                <div class="feature">
                    <span class="feature-icon">âœ“</span>
                    <span class="feature-text">3 documents per month</span>
                </div>
                <div class="feature">
                    <span class="feature-icon">âœ“</span>
                    <span class="feature-text">Plain English summaries</span>
                </div>
                <div class="feature">
                    <span class="feature-icon">âœ“</span>
                    <span class="feature-text">Basic risk detection</span>
                </div>
                <div class="feature">
                    <span class="feature-icon">âœ“</span>
                    <span class="feature-text">Basic good points detection</span>
                </div>
            </div>
            
            <button class="btn-primary" onclick="startFree()">Start Free</button>
        </div>

        <!-- Paid Tier -->
        <div class="pricing-card paid-tier featured">
            <div class="popular-badge">Most Popular</div>
            <div class="pricing-header">
                <h2>Pro</h2>
                <div class="price">
                    <span class="amount">$9.99</span>
                    <span class="period">/month</span>
                </div>
                <p class="description">Unlimited analysis with advanced features</p>
            </div>
            
            <div class="features">
                <div class="feature">
                    <span class="feature-icon">âœ“</span>
                    <span class="feature-text">Unlimited documents</span>
                </div>
                <div class="feature">
                    <span class="feature-icon">âœ“</span>
                    <span class="feature-text">Risk score badges (Green/Yellow/Red)</span>
                </div>
                <div class="feature">
                    <span class="feature-icon">âœ“</span>
                    <span class="feature-text">Side-by-side comparison</span>
                </div>
                <div class="feature">
                    <span class="feature-icon">âœ“</span>
                    <span class="feature-text">Export to PDF/Word/Excel</span>
                </div>
                <div class="feature">
                    <span class="feature-icon">âœ“</span>
                    <span class="feature-text">Advanced analytics</span>
                </div>
                <div class="feature">
                    <span class="feature-icon">âœ“</span>
                    <span class="feature-text">Priority support</span>
                </div>
            </div>
            
            <button class="btn-primary" onclick="upgradeToPro()">Upgrade to Pro</button>
        </div>
    </div>

    <div class="pricing-footer">
        <h3>All plans include:</h3>
        <ul>
            <li>Secure document processing</li>
            <li>No document storage (processed in memory)</li>
            <li>Standard support</li>
        </ul>
    </div>
    
    <!-- Subscription Management Section -->
    <div class="subscription-management" id="subscriptionManagement" style="display: none;">
        <h3>Manage Your Subscription</h3>
        <div class="subscription-info">
            <p>You have an active Pro subscription.</p>
            <button class="btn-secondary" onclick="manageSubscription()">Manage Subscription</button>
        </div>
    </div>
</div>

<script>
let currentUserId = null;

// Generate a simple user ID (in production, this would come from authentication)
function generateUserId() {
    if (!currentUserId) {
        currentUserId = 'user_' + Math.random().toString(36).substr(2, 9);
        localStorage.setItem('fineprint_user_id', currentUserId);
    }
    return currentUserId;
}

function startFree() {
    const userId = generateUserId();
    window.location.href = `/?user_id=${userId}`;
}

function upgradeToPro() {
    const userId = generateUserId();
    const email = prompt('Please enter your email address for the Pro subscription:');
    
    if (!email) {
        alert('Email is required to upgrade to Pro.');
        return;
    }
    
    // Validate email format
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
        alert('Please enter a valid email address.');
        return;
    }
    
    // Show loading state
    const button = event.target;
    const originalText = button.textContent;
    button.textContent = 'Processing...';
    button.disabled = true;
    
    // Create checkout session
    fetch('/api/create-checkout-session', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            user_id: userId,
            email: email
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Redirect to Stripe checkout
            window.location.href = data.checkout_url;
        } else {
            throw new Error(data.error || 'Failed to create checkout session');
        }
    })
    .catch(error => {
        console.error('Error creating checkout session:', error);
        alert('Error processing payment. Please try again or contact support.');
        
        // Reset button state
        button.textContent = originalText;
        button.disabled = false;
    });
}

function manageSubscription() {
    const userId = generateUserId();
    
    // Create customer portal session
    fetch('/api/create-portal-session', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            user_id: userId
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Redirect to Stripe customer portal
            window.location.href = data.portal_url;
        } else {
            throw new Error(data.error || 'Failed to create portal session');
        }
    })
    .catch(error => {
        console.error('Error creating portal session:', error);
        alert('Error accessing subscription management. Please try again or contact support.');
    });
}

// Check if user has active subscription
async function checkSubscriptionStatus() {
    const userId = generateUserId();
    
    try {
        const response = await fetch(`/api/usage/${userId}`);
        const data = await response.json();
        
        if (data.subscription === 'paid') {
            // Show subscription management section
            document.getElementById('subscriptionManagement').style.display = 'block';
            
            // Hide upgrade button
            const upgradeButton = document.querySelector('.paid-tier button');
            if (upgradeButton) {
                upgradeButton.textContent = 'Current Plan';
                upgradeButton.disabled = true;
                upgradeButton.classList.remove('btn-primary');
                upgradeButton.classList.add('btn-secondary');
            }
        }
    } catch (error) {
        console.error('Error checking subscription status:', error);
    }
}

// Load user ID from localStorage on page load
document.addEventListener('DOMContentLoaded', function() {
    const savedUserId = localStorage.getItem('fineprint_user_id');
    if (savedUserId) {
        currentUserId = savedUserId;
    }
    
    // Check subscription status
    checkSubscriptionStatus();
});
</script>
        </main>
    </div>
</body>
</html>
